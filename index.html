<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Lucky Horse Race — 경마게임 · 랜덤게임 · 온라인 추첨</title>

  <!-- 404 방지용 파비콘(투명) -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'/%3E">

  <style>
    :root{
      --bg:#0b1220; --panel:#0f172a; --ink:#e5e7eb; --muted:#94a3b8; --border:#1f2937; --accent:#6ee7ff;
      --accent2:#fcd34d; --danger:#ef4444; --ok:#22c55e;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{color:var(--ink);background:#0b1220;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR","Malgun Gothic",sans-serif}

    /* 기본 스타일 */
    .notice{
      position:absolute; top:8px; left:12px; z-index:40;
      background:rgba(0,0,0,.45); padding:6px 12px; border-radius:10px;
      font-size:13px; color:#cbd5e1; backdrop-filter: blur(2px);
    }

    /* 타원맵 복원 */
    .ovalSvg{width:100%;height:auto;display:block}
    .horse{position:absolute;width:46px;height:34px;transform:translate(-50%,-50%);pointer-events:none; z-index:8}
    .horse .nameplate{position:absolute;bottom:100%;left:50%;transform:translate(-50%,-8px);background:#09111e;color:#dbe7f3;border:1px solid #2a3b57;border-radius:10px;font-size:11px;font-weight:800;padding:3px 8px;white-space:nowrap}

    /* 회전맵 */
    #spinMap{width:100%;height:auto;display:block}

    /* 점프맵 */
    .horse.buried {
      opacity: 0.3;
    }

    .horse .face {
      display: none; 
      position: absolute;
      bottom: 10px; 
      left: 50%;
      transform: translateX(-50%);
    }

    .horse .nameplate {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translate(-50%, -8px);
      background: #09111e;
      color: #dbe7f3;
      border: 1px solid #2a3b57;
      border-radius: 10px;
      font-size: 11px;
      font-weight: 800;
      padding: 3px 8px;
      white-space: nowrap;
      opacity: 1;
    }

  </style>
</head>
<body>
  <div class="wrap">

    <div class="notice">자유롭게 사용해주시고 피드백 부탁드립니다.</div>

    <!-- HUD -->
    <div class="hud" id="hud">
      <div class="traffic">
        <div class="light" id="ltR"></div>
        <div class="light" id="ltY"></div>
        <div class="light" id="ltG"></div>
        <span class="countTxt" id="countTxt">Ready</span>
        <span class="gun" id="gunTxt"></span>
      </div>
    </div>

    <!-- Stage -->
    <div class="stage" id="stage">
      <div class="viewport" id="viewport">
        <div class="canvas" id="canvas">
          <!-- 타원맵 -->
          <svg id="ovalMap" class="ovalSvg" viewBox="0 0 1000 600" style="display:none"></svg>
          <!-- 회전맵 -->
          <svg id="spinMap" class="spinSvg" viewBox="0 0 2000 400" style="display:none"></svg>
          <!-- 점프맵 -->
          <svg id="sandJumpMap" class="jumpSvg" viewBox="0 0 2000 400" style="display:none"></svg>
        </div>
      </div>

      <!-- 순위판 -->
      <div id="rankingBox" class="ranking">
        <h3>현재 순위</h3>
        <div id="rankingLines"></div>
      </div>
    </div>

    <!-- 하단 UI -->
    <header>
      <div class="controls left">
        <input id="names" type="text" placeholder="참가자 입력 (예: 고구마 감자 김치 / 고구마*3)">
        <select id="raceLen" style="display:none">
          <option value="1">1바퀴</option>
          <option value="3" selected>3바퀴</option>
          <option value="5">5바퀴</option>
          <option value="10">10바퀴</option>
        </select>
        <select id="raceDist">
          <option value="100" selected>100m</option>
          <option value="200">200m</option>
          <option value="300">300m</option>
          <option value="500">500m</option>
          <option value="1000">1km</option>
        </select>

        <button class="btn-ghost" id="shuffleBtn">말 섞기</button>
        <button class="btn-accent" id="startBtn">시작 ▶</button>
        <button class="btn-ghost" id="resetBtn">리셋</button>

        <button class="btn-ghost" id="mapToggleBtn">맵: 직선</button>
        <button class="btn-ghost btn-toggle" id="firstCamBtn">1등 뷰 OFF</button>
      </div>

      <div class="controls right">
        <!-- 추첨 메뉴 -->
        <div class="seg" id="drawSeg" style="display:inline-flex; gap:6px; align-items:center; background:rgba(255,255,255,.05); border:1px solid #2a3b57; border-radius:12px; padding:6px; flex-wrap:wrap;">
          <label class="seg-item on" data-type="first" style="position:relative">
            <input type="radio" name="draw" value="first" checked style="display:none">
            <span style="display:inline-block; padding:8px 12px; border-radius:10px; border:1px solid #2a3b57; background:linear-gradient(180deg,#1b9ab7,#168aa4); color:#06131b; font-weight:800; cursor:pointer;">1등</span>
          </label>
          <!-- 추가 -->
        </div>
        <a href="https://buymeacoffee.com/luckyhorse" target="_blank" class="btn-accent btn">개발자 컵라면 사주기 🍜</a>
        <button class="btn-ghost" id="btnContact">문의 및 건의사항</button>
      </div>
    </header>

  </div>

  <script>
    // 기존 타원맵 복원
    function drawOvalMap() {
      const rx=420, ry=220;
      $ovalMap.innerHTML = `
        <ellipse cx="500" cy="300" rx="${rx}" ry="${ry}" fill="#0e1a2a" stroke="#2a3b54" stroke-width="2"/>
        <ellipse cx="500" cy="300" rx="${rx-60}" ry="${ry-60}" fill="#0b1220" stroke="#1f2937" stroke-width="2"/>
        <ellipse cx="500" cy="300" rx="${rx-30}" ry="${ry-30}" fill="none" stroke="#5b708f" stroke-dasharray="6,6" stroke-width="2"/>
        <text x="500" y="70" text-anchor="middle" font-size="14" fill="#a5f3fc" font-weight="800">출발/도착</text>
      `;
    }

    // 회전맵 추가
    function drawSpinMap() {
      const W = 2000, H = 400;
      $spinMap.setAttribute('viewBox', `0 0 ${W} ${H}`);
      $spinMap.innerHTML = `
          <circle cx="1000" cy="200" r="150" fill="none" stroke="#5b708f" stroke-width="6"/>
          <circle cx="1000" cy="200" r="120" fill="none" stroke="#22d3ee" stroke-dasharray="6,6" stroke-width="4"/>
          <text x="1000" y="100" text-anchor="middle" font-size="14" fill="#a5f3fc" font-weight="800">회전의 왕</text>
      `;
    }

    // 점프맵 추가
    function drawJumpMap() {
      const W = 2000, H = 400;
      $sandJumpMap.setAttribute('viewBox', `0 0 ${W} ${H}`);
      $sandJumpMap.innerHTML = `
          <rect x="0" y="300" width="${W}" height="100" fill="tan" />
          <text x="${W / 2}" y="290" text-anchor="middle" font-size="14" fill="#a5f3fc" font-weight="800">점프의 왕</text>
      `;
    }

    // 맵 전환 및 처리
    let mapMode = "oval";
    function updateMap() {
      if (mapMode === "oval") {
        drawOvalMap();
      } else if (mapMode === "spin") {
        drawSpinMap();
      } else if (mapMode === "jump") {
        drawJumpMap();
      }
    }

    // 회전과 점프 등 각 맵에서 일어나는 행동 처리
    function spinHorse(horse) {
      const angle = horse.rotationAngle += Math.random() * 5;
      const radian = angle * Math.PI / 180;
      const distance = 150 * Math.sin(radian);
      horse.x += distance;
      horse.y = 200 + 150 * Math.cos(radian);
      horse.$el.style.left = `${horse.x}px`;
      horse.$el.style.top = `${horse.y}px`;
      horse.$el.style.transform = `rotate(${angle}deg)`;
    }

    function jumpHorse(horse) {
      const jumpDistance = Math.random() * 50 + 100;
      horse.x += jumpDistance;
      horse.done = true;
      handleJumpLanding(horse);
      updateJumpRanking();
    }

    // 경주 시작
    function startGame() {
      // 게임 로직
      gameLoop(); // 게임 루프 시작
    }
  </script>
</body>
</html>
