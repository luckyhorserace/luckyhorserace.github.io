<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Lucky Horse Race â€” ê²½ë§ˆê²Œì„ Â· ëœë¤ê²Œì„ Â· ì˜¨ë¼ì¸ ì¶”ì²¨</title>

  <!-- 404 ë°©ì§€ìš© íŒŒë¹„ì½˜(íˆ¬ëª…) -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'/%3E">

  <style>
    :root{
      --bg:#0b1220; --panel:#0f172a; --ink:#e5e7eb; --muted:#94a3b8; --border:#1f2937; --accent:#6ee7ff;
      --accent2:#fcd34d; --danger:#ef4444; --ok:#22c55e;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{color:var(--ink);background:#0b1220;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR","Malgun Gothic",sans-serif}

    /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    .notice{
      position:absolute; top:8px; left:12px; z-index:40;
      background:rgba(0,0,0,.45); padding:6px 12px; border-radius:10px;
      font-size:13px; color:#cbd5e1; backdrop-filter: blur(2px);
    }

    /* íƒ€ì›ë§µ ë³µì› */
    .ovalSvg{width:100%;height:auto;display:block}
    .horse{position:absolute;width:46px;height:34px;transform:translate(-50%,-50%);pointer-events:none; z-index:8}
    .horse .nameplate{position:absolute;bottom:100%;left:50%;transform:translate(-50%,-8px);background:#09111e;color:#dbe7f3;border:1px solid #2a3b57;border-radius:10px;font-size:11px;font-weight:800;padding:3px 8px;white-space:nowrap}

    /* íšŒì „ë§µ */
    #spinMap{width:100%;height:auto;display:block}

    /* ì í”„ë§µ */
    .horse.buried {
      opacity: 0.3;
    }

    .horse .face {
      display: none; 
      position: absolute;
      bottom: 10px; 
      left: 50%;
      transform: translateX(-50%);
    }

    .horse .nameplate {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translate(-50%, -8px);
      background: #09111e;
      color: #dbe7f3;
      border: 1px solid #2a3b57;
      border-radius: 10px;
      font-size: 11px;
      font-weight: 800;
      padding: 3px 8px;
      white-space: nowrap;
      opacity: 1;
    }

  </style>
</head>
<body>
  <div class="wrap">

    <div class="notice">ììœ ë¡­ê²Œ ì‚¬ìš©í•´ì£¼ì‹œê³  í”¼ë“œë°± ë¶€íƒë“œë¦½ë‹ˆë‹¤.</div>

    <!-- HUD -->
    <div class="hud" id="hud">
      <div class="traffic">
        <div class="light" id="ltR"></div>
        <div class="light" id="ltY"></div>
        <div class="light" id="ltG"></div>
        <span class="countTxt" id="countTxt">Ready</span>
        <span class="gun" id="gunTxt"></span>
      </div>
    </div>

    <!-- Stage -->
    <div class="stage" id="stage">
      <div class="viewport" id="viewport">
        <div class="canvas" id="canvas">
          <!-- íƒ€ì›ë§µ -->
          <svg id="ovalMap" class="ovalSvg" viewBox="0 0 1000 600" style="display:none"></svg>
          <!-- íšŒì „ë§µ -->
          <svg id="spinMap" class="spinSvg" viewBox="0 0 2000 400" style="display:none"></svg>
          <!-- ì í”„ë§µ -->
          <svg id="sandJumpMap" class="jumpSvg" viewBox="0 0 2000 400" style="display:none"></svg>
        </div>
      </div>

      <!-- ìˆœìœ„íŒ -->
      <div id="rankingBox" class="ranking">
        <h3>í˜„ì¬ ìˆœìœ„</h3>
        <div id="rankingLines"></div>
      </div>
    </div>

    <!-- í•˜ë‹¨ UI -->
    <header>
      <div class="controls left">
        <input id="names" type="text" placeholder="ì°¸ê°€ì ì…ë ¥ (ì˜ˆ: ê³ êµ¬ë§ˆ ê°ì ê¹€ì¹˜ / ê³ êµ¬ë§ˆ*3)">
        <select id="raceLen" style="display:none">
          <option value="1">1ë°”í€´</option>
          <option value="3" selected>3ë°”í€´</option>
          <option value="5">5ë°”í€´</option>
          <option value="10">10ë°”í€´</option>
        </select>
        <select id="raceDist">
          <option value="100" selected>100m</option>
          <option value="200">200m</option>
          <option value="300">300m</option>
          <option value="500">500m</option>
          <option value="1000">1km</option>
        </select>

        <button class="btn-ghost" id="shuffleBtn">ë§ ì„ê¸°</button>
        <button class="btn-accent" id="startBtn">ì‹œì‘ â–¶</button>
        <button class="btn-ghost" id="resetBtn">ë¦¬ì…‹</button>

        <button class="btn-ghost" id="mapToggleBtn">ë§µ: ì§ì„ </button>
        <button class="btn-ghost btn-toggle" id="firstCamBtn">1ë“± ë·° OFF</button>
      </div>

      <div class="controls right">
        <!-- ì¶”ì²¨ ë©”ë‰´ -->
        <div class="seg" id="drawSeg" style="display:inline-flex; gap:6px; align-items:center; background:rgba(255,255,255,.05); border:1px solid #2a3b57; border-radius:12px; padding:6px; flex-wrap:wrap;">
          <label class="seg-item on" data-type="first" style="position:relative">
            <input type="radio" name="draw" value="first" checked style="display:none">
            <span style="display:inline-block; padding:8px 12px; border-radius:10px; border:1px solid #2a3b57; background:linear-gradient(180deg,#1b9ab7,#168aa4); color:#06131b; font-weight:800; cursor:pointer;">1ë“±</span>
          </label>
          <!-- ì¶”ê°€ -->
        </div>
        <a href="https://buymeacoffee.com/luckyhorse" target="_blank" class="btn-accent btn">ê°œë°œì ì»µë¼ë©´ ì‚¬ì£¼ê¸° ğŸœ</a>
        <button class="btn-ghost" id="btnContact">ë¬¸ì˜ ë° ê±´ì˜ì‚¬í•­</button>
      </div>
    </header>

  </div>

  <script>
    // ê¸°ì¡´ íƒ€ì›ë§µ ë³µì›
    function drawOvalMap() {
      const rx=420, ry=220;
      $ovalMap.innerHTML = `
        <ellipse cx="500" cy="300" rx="${rx}" ry="${ry}" fill="#0e1a2a" stroke="#2a3b54" stroke-width="2"/>
        <ellipse cx="500" cy="300" rx="${rx-60}" ry="${ry-60}" fill="#0b1220" stroke="#1f2937" stroke-width="2"/>
        <ellipse cx="500" cy="300" rx="${rx-30}" ry="${ry-30}" fill="none" stroke="#5b708f" stroke-dasharray="6,6" stroke-width="2"/>
        <text x="500" y="70" text-anchor="middle" font-size="14" fill="#a5f3fc" font-weight="800">ì¶œë°œ/ë„ì°©</text>
      `;
    }

    // íšŒì „ë§µ ì¶”ê°€
    function drawSpinMap() {
      const W = 2000, H = 400;
      $spinMap.setAttribute('viewBox', `0 0 ${W} ${H}`);
      $spinMap.innerHTML = `
          <circle cx="1000" cy="200" r="150" fill="none" stroke="#5b708f" stroke-width="6"/>
          <circle cx="1000" cy="200" r="120" fill="none" stroke="#22d3ee" stroke-dasharray="6,6" stroke-width="4"/>
          <text x="1000" y="100" text-anchor="middle" font-size="14" fill="#a5f3fc" font-weight="800">íšŒì „ì˜ ì™•</text>
      `;
    }

    // ì í”„ë§µ ì¶”ê°€
    function drawJumpMap() {
      const W = 2000, H = 400;
      $sandJumpMap.setAttribute('viewBox', `0 0 ${W} ${H}`);
      $sandJumpMap.innerHTML = `
          <rect x="0" y="300" width="${W}" height="100" fill="tan" />
          <text x="${W / 2}" y="290" text-anchor="middle" font-size="14" fill="#a5f3fc" font-weight="800">ì í”„ì˜ ì™•</text>
      `;
    }

    // ë§µ ì „í™˜ ë° ì²˜ë¦¬
    let mapMode = "oval";
    function updateMap() {
      if (mapMode === "oval") {
        drawOvalMap();
      } else if (mapMode === "spin") {
        drawSpinMap();
      } else if (mapMode === "jump") {
        drawJumpMap();
      }
    }

    // íšŒì „ê³¼ ì í”„ ë“± ê° ë§µì—ì„œ ì¼ì–´ë‚˜ëŠ” í–‰ë™ ì²˜ë¦¬
    function spinHorse(horse) {
      const angle = horse.rotationAngle += Math.random() * 5;
      const radian = angle * Math.PI / 180;
      const distance = 150 * Math.sin(radian);
      horse.x += distance;
      horse.y = 200 + 150 * Math.cos(radian);
      horse.$el.style.left = `${horse.x}px`;
      horse.$el.style.top = `${horse.y}px`;
      horse.$el.style.transform = `rotate(${angle}deg)`;
    }

    function jumpHorse(horse) {
      const jumpDistance = Math.random() * 50 + 100;
      horse.x += jumpDistance;
      horse.done = true;
      handleJumpLanding(horse);
      updateJumpRanking();
    }

    // ê²½ì£¼ ì‹œì‘
    function startGame() {
      // ê²Œì„ ë¡œì§
      gameLoop(); // ê²Œì„ ë£¨í”„ ì‹œì‘
    }
  </script>
</body>
</html>
